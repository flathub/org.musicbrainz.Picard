{
    "id": "org.musicbrainz.Picard",
    "runtime": "org.kde.Platform",
    "runtime-version": "5.11",
    "sdk": "org.kde.Sdk",
    "command": "picard",
    "rename-desktop-file": "picard.desktop",
    "rename-icon": "picard",
    "finish-args": [
        "--share=ipc",
        "--socket=x11",
        "--socket=wayland",
        "--share=network",
        "--device=all",
        "--filesystem=home",
        "--filesystem=xdg-music"
    ],
    "build-options": {
        "cflags": "-O2 -g -pipe -fstack-protector-strong -D_FORTIFY_SOURCE=2",
        "cxxflags": "-O2 -g -pipe -fstack-protector-strong -D_FORTIFY_SOURCE=2",
        "ldflags": "-fstack-protector-strong -Wl,-z,relro,-z,now",
        "env": {
            "PYTHON": "/usr/bin/python3",
            "PIP": "/usr/bin/pip3"
        }
    },	
    "modules": [
        {
            "name": "sip",
            "sources": [
                {
                    "type": "archive",
                    /* Sourceforge URLs fail intermitently, get the tarballs from Fedora, check the upstream hashes */
                    "url": "https://src.fedoraproject.org/repo/pkgs/rpms/sip/sip-4.19.13.tar.gz/sha512/eb456e1f7efa463f859047acc5301e19279e1627629d0bad3ac7a0a52b77575126bc3f2c64bb4278ae11d415c13d2731dfc8c816bba71307173d393a414aae98/sip-4.19.13.tar.gz",
                    "sha256": "e353a7056599bf5fbd5d3ff9842a6ab2ea3cf4e0304a0f925ec5862907c0d15e"
                },
                {
                    "type": "file",
                    "path": "sip-configure",
                    "dest-filename": "configure"
                }
            ],
            "cleanup": [
                "/bin",
                "/include"
            ]
        },
        {
            "name": "pyqt",
            "sources": [
                {
                    "type": "archive",
                    /* Sourceforge URLs fail intermitently, get the tarballs from Fedora, check the upstream hashes */
                    "url": "https://src.fedoraproject.org/repo/pkgs/rpms/python-qt5/PyQt5_gpl-5.11.3.tar.gz/sha512/6f4abb1866ce357263c208121607072e127c8853e9c6bf039b034fefdda4c40e38f917c3b313375f0d692d764ecf26ff3a6b12cda2a2eeb5237db8b5e9443548/PyQt5_gpl-5.11.3.tar.gz",
                    "sha256": "c9b57d15601d436faf35dacf8e0acefa220194829a653e771e80b189b3261073"
                },
                {
                    "type": "file",
                    "path": "pyqt-configure",
                    "dest-filename": "configure"
                }
            ],
            "cleanup": [
                "/bin"
            ]
        },
        {
            "name": "ffmpeg",
            "config-opts": [
                "--enable-shared",
                "--disable-static",
                "--disable-doc",
                "--enable-gpl",
                "--enable-version3",
                "--disable-nonfree",
                "--enable-optimizations",
                "--enable-pthreads",

                "--disable-bzlib",
                "--disable-libgsm",
                "--enable-libvorbis",
                "--enable-zlib",
                "--disable-libxcb",
                "--disable-lzma",

                "--disable-programs",
                "--disable-network",

                "--disable-protocols",
                "--enable-protocol=file",

                "--disable-devices",

                "--disable-muxers",

                "--disable-demuxers",
                "--enable-demuxer=flac",
                "--enable-demuxer=mp3",
                "--enable-demuxer=ogg",

                "--disable-parsers",
                "--enable-parser=flac",
                "--enable-parser=vorbis",

                "--disable-encoders",

                "--disable-decoders",
                "--enable-decoder=flac",
                "--enable-decoder=libvorbis",
                "--enable-decoder=mp3"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://www.ffmpeg.org/releases/ffmpeg-3.4.4.tar.xz",
                    "sha256": "386f7601e865df6bddde05bb6927119b5a853f0b92e2e9834f59c125a17d3fc6"
                }
            ],
            "cleanup": [
                "/lib/*.so",
                "/include",
                "/lib/pkgconfig",
                "/share/ffmpeg"
            ]
        },
        {
            "name": "chromaprint",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DCMAKE_BUILD_TYPE:STRING=Release",
                "-DBUILD_TOOLS:BOOL=ON"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/acoustid/chromaprint/releases/download/v1.4.3/chromaprint-1.4.3.tar.gz",
                    "sha256": "ea18608b76fb88e0203b7d3e1833fb125ce9bb61efe22c6e169a50c52c457f82"
                }
            ],
            "cleanup": [
                "/include",
                "/lib/pkgconfig"
            ]
        },
        {
            "name": "libdiscid",
            "config-opts": [
                "--disable-static"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://ftp.musicbrainz.org/pub/musicbrainz/libdiscid/libdiscid-0.6.2.tar.gz", /* No HTTPS */
                    "sha256": "f9e443ac4c0dd4819c2841fcc82169a46fb9a626352cdb9c7f65dd3624cd31b9"
                }
            ],
            "cleanup": [
                "/include",
                "/lib/pkgconfig"
            ]
        },
        {
            "name": "python-pkgconfig",
            "buildsystem": "simple",
            "build-commands": [
                "${PIP} install --no-deps --prefix=/app ."
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/source/p/pkgconfig/pkgconfig-1.4.0.tar.gz",
                    "sha256": "048c3b457da7b6f686b647ab10bf09e2250e4c50acfe6f215398a8b5e6fcdb52"
                }
            ]
        },
        {
            "name": "python-libdiscid",
            "buildsystem": "simple",
            "build-commands": [
                "${PIP} install --no-deps --prefix=/app ."
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/source/p/python-libdiscid/python-libdiscid-1.0.tar.gz",
                    "sha256": "9b8203ac5e36116df430a4808f6552d59e38b458d53ba59aee31dbfaf366d311"
                }
            ]
        },
        {
            "name": "mutagen",
            "buildsystem": "simple",
            "build-commands": [
                "${PIP} install --no-deps --prefix=/app ."
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/source/m/mutagen/mutagen-1.41.1.tar.gz",
                    "sha256": "2ea9c900a05fa7f5f4c5bd9fc1475d7d576532e13b2f79b694452b997ff67200"
                }
            ],
            "cleanup": [
                "/bin",
                "/share/man"
            ]
        },
        {
            "name": "picard",
            "buildsystem": "simple",
            "build-commands": [
                "${PIP} install --egg --no-deps --prefix=/app ."
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://ftp.musicbrainz.org/pub/musicbrainz/picard/picard-2.0.4.tar.gz", /* No HTTPS */
                    "sha256": "0c6ee49e0c6dd61793e5705823570055e55e7601d665c9be75271c8b2ff54337"
                },
                {
                    "type": "file",
                    "path": "org.musicbrainz.Picard.appdata.xml"
                }
            ],
            "post-install": [
                "mkdir -p /app/share/appdata",
                "install -m0644 -p org.musicbrainz.Picard.appdata.xml /app/share/appdata/"
            ]
        }
    ]
}
